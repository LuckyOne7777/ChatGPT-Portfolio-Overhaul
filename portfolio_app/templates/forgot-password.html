<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reset Password - Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: linear-gradient(120deg, #a1c4fd, #c2e9fb);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .login-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 400px;
            padding: 40px;
        }
        
        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .input-group {
            position: relative;
            margin-bottom: 20px;
        }
        
        .input-group i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            border-color: #a1c4fd;
            outline: none;
        }
        
        .toggle-password {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #777;
            cursor: pointer;
        }
        
        button[type="submit"] {
            width: 100%;
            padding: 12px;
            background-color: #6c63ff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button[type="submit"]:hover {
            background-color: #554fd8;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
        
        .success-message {
            color: #27ae60;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
        
        .back-to-login {
            text-align: center;
            margin-top: 20px;
            color: #777;
        }
        
        .back-to-login a {
            color: #6c63ff;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .back-to-login a:hover {
            text-decoration: underline;
            color: #554fd8;
        }
        
        .password-requirements {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
        }
        
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
<div class="login-container">
    <form id="reset-password-form">
        <h2>Reset Password</h2>
        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <label class="visually-hidden" for="reset-email">Email</label>
            <input type="email" id="reset-email" placeholder="Your email" required>
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <label class="visually-hidden" for="new-password">New Password</label>
            <input type="password" id="new-password" placeholder="New Password" required minlength="8">
            <button type="button" id="toggle-new-password" class="toggle-password" aria-label="Show password">
                <i class="fas fa-eye"></i>
            </button>
            
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <label class="visually-hidden" for="confirm-password">Confirm Password</label>
            <input type="password" id="confirm-password" placeholder="Confirm Password" required>
            <button type="button" id="toggle-confirm-password" class="toggle-password" aria-label="Show password">
                <i class="fas fa-eye"></i>
            </button>
        </div>
        <button type="submit">Reset Password</button>
        <p id="error" class="error-message" role="alert"></p>
        <p id="success" class="success-message" role="alert"></p>
        <div class="back-to-login">
            <a href="/login">Back to Login</a>
        </div>
    </form>
</div>
<script>

function setupPasswordToggle(passwordFieldId, toggleButtonId) {
    const passwordField = document.getElementById(passwordFieldId);
    const toggleButton = document.getElementById(toggleButtonId);
    
    toggleButton.addEventListener('click', () => {
        const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordField.setAttribute('type', type);
        toggleButton.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
    });
}

setupPasswordToggle('new-password', 'toggle-new-password');
setupPasswordToggle('confirm-password', 'toggle-confirm-password');

document.getElementById('reset-password-form').addEventListener('submit', async e => {
    e.preventDefault();
    const errorEl = document.getElementById('error');
    const successEl = document.getElementById('success');
    errorEl.textContent = '';
    successEl.textContent = '';
    
    const email = document.getElementById('reset-email').value;
    const password = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
 
    if (!email || !password || !confirmPassword) {
        errorEl.textContent = 'All fields are required';
        return;
    }
    
    if (password !== confirmPassword) {
        errorEl.textContent = 'Passwords do not match';
        return;
    }
    
    if (password.length < 8) {
        errorEl.textContent = 'Password must be at least 8 characters long';
        return;
    }
    
    try {
        const res = await fetch('/api/reset-password', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                email: email,
                password: password,
                confirm_password: confirmPassword
            })
        });
        
        const data = await res.json();
        
        if (res.ok) {
            successEl.textContent = data.message || 'Password has been reset successfully';
           
            setTimeout(() => {
                window.location.href = '/login';
            }, 1000);
        } else {
            errorEl.textContent = data.message || 'Failed to reset password';
        }
    } catch (err) {
        errorEl.textContent = 'Network error';
    }
});
</script>
</body>
</html>