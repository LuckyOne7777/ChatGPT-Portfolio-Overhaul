<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Sample Portfolio</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <style>
        .chart-container { position: relative; width: 100%; max-width: 800px; height: 400px; }
    </style>
</head>
<body>
    <h1>Sample Portfolio Equity History</h1>
    <div class="chart-container">
        <canvas id="equityChart"></canvas>
        <button id="resetZoom">Reset Zoom</button>
    </div>
    <script>
    if (window.Chart && window.ChartZoom) { Chart.register(window.ChartZoom); }
    (async () => {
        const canvas = document.getElementById('equityChart');
        const resetBtn = document.getElementById('resetZoom');
        try {
            const res = await fetch('/api/sample-equity-history');
            if (!res.ok) throw new Error('Failed to load equity history');
            const data = await res.json();
            if (!Array.isArray(data) || data.length === 0) {
                const msg = document.createElement('p');
                msg.textContent = 'No data available';
                canvas.replaceWith(msg);
                resetBtn.remove();
                return;
            }
            const points = data.map(d => ({ x: d.date, y: parseFloat(d.equity) }));
            const chart = new Chart(canvas, {
                type: 'line',
                data: { datasets: [{ label: 'Equity', data: points, borderColor: '#1f77b4', backgroundColor: '#1f77b4', pointRadius: 3, pointHoverRadius:5, pointBackgroundColor:'#1f77b4', pointHoverBackgroundColor:'#1f77b4', tension:0, fill:false }] },
                options: {
                    responsive: true,
                    interaction: { mode: 'nearest', intersect: true },
                    plugins: {
                        tooltip: { callbacks: { label: ctx => `$${ctx.parsed.y.toFixed(2)}` } },
                        zoom: {
                            zoom: { wheel: { enabled: true, modifierKey: 'alt' }, mode: 'x' },
                            pan: { enabled: true, modifierKey: 'shift', mode: 'x' }
                        }
                    },
                    onClick: (e, elements) => {
                        if (elements.length) {
                            const p = chart.data.datasets[0].data[elements[0].index];
                            console.log({ date: p.x, equity: p.y });
                        }
                    },
                    scales: {
                        x: { type: 'time', time: { parser: 'yyyy-MM-dd', tooltipFormat: 'PP' }, ticks: { color: '#000' }, grid: { color: '#e0e0e0' } },
                        y: { ticks: { color: '#000', callback: v => `$${v}` }, grid: { color: '#e0e0e0' } }
                    }
                }
            });
            resetBtn.onclick = () => chart.resetZoom();
        } catch (err) {
            console.error(err);
            const msg = document.createElement('p');
            msg.textContent = 'No data available';
            canvas.replaceWith(msg);
            resetBtn.remove();
        }
    })();
    </script>
</body>
</html>
